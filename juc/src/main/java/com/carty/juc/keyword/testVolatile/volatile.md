# volatile学习

1. volatile可以保证线程可见性且提供了一定的有序性，但是无法保证原子性。在JVM底层volatile是采用“内存屏障”来实现的。
   + 保证可见性，不保证原子性
   + 禁止指令重排序

2. 保证可见性，不保证原子性
   + 可见性：任何时刻只要有任何线程修改了volatile变量，其他线程总能获取到最新值
   + 原子性：整个程序中的所有操作，要么全部完成，要么全部不完成，不可能停滞在中间某个环节。
      + 举例说明：i++ 操作，操作分为三个步骤：读取变量值，增加变量值，回写变量值让其他线程可见。在执行这三个步骤时，变量值随时都会被别的线程修改，导致最终的结果错误。

3. 禁止指令重排序
   + 指令重排序是指：在执行程序时为了提高性能，编译器和处理器通常会对指令做重排序。指令重排序对单线程没有什么影响，不会影响程序的运行结果；但是会影响多线程的正确性

4. 使用场景
   + 对变量的写操作不依赖当前值；
   + 该变量没有包含在具有其他变量的不变式中。